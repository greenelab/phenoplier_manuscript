### Clusters of traits in the gene module space are associated with relevant transcriptional processes

![
**Cluster analysis on traits from PhenomeXcan.**
<!--  -->
**a)** The projection of TWAS results for 3,752 traits to the latent
representation learned from recount2 are the input data to the clustering
process. A linear (PCA) and non-linear (UMAP) dimensionality reduction
techniques are applied to the input data, and the three data versions are
processed by five different clustering algorithms. These algorithms derive
partitions from the data using different sets of parameters (such as the number
of clusters), leading to an ensemble of 4,428 partitions. A coassociation matrix
is derived by counting how many times a pair of traits were grouped together in
the ensemble. Finally, a consensus function is applied to the coassociation
matrix to generate consolidated partitions with different number of clusters.
These final solutions are represented in the clustering tree (Figure
@fig:clustering:tree).
<!--  -->
**b)** The clusters found by the consensus function are used as labels to train a decision tree classifier on the original input data, which detects the most important LVs that differentiate groups of traits.
<!--  -->
](images/clustering/clustering_design.svg "Cluster analysis on
traits"){#fig:clustering:design width="100%"}


All traits in PhenomeXcan were projected into the latent space learned from
recount2 using Equation (@eq:proj). We conducted cluster analysis using this new
representation to find groups of traits that are similarly affected by the same
transcriptional processes.
<!--  -->
To avoid using a single clustering algorithm (which implies using a single
assumption about the structure of the data), we employed a consensus clustering
approach where different methods with varying sets parameters are applied on the
same data, and later combined into a consolidated solution
[@doi:10.1016/j.ins.2016.04.027; @doi:10.1109/TPAMI.2005.237; @Strehl2002]
(Figure @fig:clustering:design).
<!--  -->
An important property for a successful application of a consensus clustering
approach is the diversity of the ensemble, understood as the level of
disagreement between the base clustering solutions
[@doi:10.1016/j.ins.2016.04.027; @doi:10.1109/TPAMI.2011.84;
@doi:10.1016/j.patcog.2014.04.005].
A diverse set of solutions can be generated by using different data representations (such as dimensionality reduction methods or subsets of features), clustering algorithms with distinct assumptions ($k$-means, for instance, assumes hyperspherical clusters), and a varying set of algorithm's parameters (such as the number of clusters or the initial random seeds).
<!--  -->
In our approach, we performed cluster analysis using five different clustering
algorithms on three representations of the input data (the original data with
987 latent variables, its projection into the top 50 principal components, and
the embedding learned by UMAP [@arxiv:1802.03426] using 50 components) (see
Figure @fig:clustering:design a). The clustering methods used cover a wide range
of different assumptions on cluster shapes and a varying set of parameters such
as the number of clusters (from 2 to 60), the width of the Gaussian kernel in
spectral clustering, and other method-specific parameters (see the supplementary
material for more details).
<!--  -->
The process generated an ensemble with 4,428 clustering solutions for all
traits. This ensemble was used to derive a coassociation matrix between traits
by counting the number of times a pair of traits was clustered together.
A consensus function was applied on the coassociation matrix to derive a consolidated solution using the information in the ensemble.
For these final partitions, we did not select a specific number of clusters, but instead used a clustering tree [@doi:10.1093/gigascience/giy083] (Figure @fig:clustering:tree) to examine stable groups of traits at multiple resolutions.
<!--  -->
Finally, for the interpretation of the clusters, we trained a decision tree
classifier (a highly interpretable machine learning model) on the original
input data using the clusters found as labels. This approach allowed us to
quickly identify the most important gene modules for the groups of traits found.
<!--  -->
More details of the clustering process are available in the supplementary
material.


![
**Clustering tree using multiple resolutions for clusters of traits.**
<!--  -->
Clustering tree of traits partitions at different resolutions (from 5 to 26 clusters).
Each row represents a partition of the traits, and each circle is a cluster from that partition.
Arrows indicate how traits in one cluster move across clusters from different partitions.
Most of the clusters are preserved across different resolutions, showing a high stability even with independent runs of the clustering algorithm.
<!--  -->
BMR: basal metabolic rate;
WC: waist/hip circumference;
MCV: mean corpuscular volume;
MCH: mean corpuscular hemoglobin;
MRV: mean reticulocyte volume;
MRV: mean reticulocyte volume;
MSCV: mean sphered cell volume;
RDW: red cell (erythrocyte) distribution width;
RA: rheumatoid arthritis;
SLE: systemic lupus erythematosus;
<sup>a</sup> includes whole-body, arms and legs impedances;
<sup>b</sup> allergies refer to allergic rhinitis or atopic dermatitis;
<sup>c</sup> includes Alzheimer's disease, coronary artery disease, breast cancer, fasting blood glucose and insulin measurements, inflammatory bowel disease, and atopic dermatitis;
<sup>d</sup> includes erythrocyte count, hemoglobin concentration, and hematocrit percentage;
<sup>e</sup> includes reticulocyte count and percentage, immature reticulocyte fraction, and high light scatter reticulocytes count and percentage;
<sup>f</sup> includes platelet count, platelet crit, mean platelet volume, and platelet distribution width.
<sup>g</sup> includes diabetes, gout, arthrosis, and respiratory diseases (and related medications such as ramipril, allopurinol, lisinopril, and albuterol), and several environmental/behavioral factors such as intake of a range of common food/drink items including alcohol, time spent outdoors and watching TV, smoking and sleeping habits, early-life factors, education attainment, psychological and mental health, and health satisfaction.
<sup>h</sup> includes vascular problems such as angina, deep vein thrombosis (DVT), intraocular pressure, eye and mouth problems, hand-grip strength, several measurements of physical activity, jobs involving heavy physical work, transport type for commuting, intake of common vitamin/mineral supplements, and various types of body pain and medications for pain relief.
<sup>i</sup> age when diabetes was first diagnosed;
<sup>j</sup> includes neutrophil count, neutrophil+basophil count, neutrophil+eosinophil count, granulocyte count, leukocyte count, and myeloid cell count.
<!--  -->
](images/clustering/clustering_tree.svg "Clustering tree using the consensus solutions for traits"){#fig:clustering:tree width="100%"}


A clustering tree of the consensus solutions at different resolutions is shown in Figure @fig:clustering:tree.
For each $k$ (the number of clusters), the consensus partition that maximized the agreement with the ensemble was selected (see supplementary material).
Since it is expected that a subset of resolutions better represents the patterns among traits, we further filtered the consensus partitions by taking those with an agreement value higher than the 75th percentile, which included partitions from 5 to 26 clusters.


The clustering tree shows five clear branches that start at the top with different numerical labels (from left to right):
0) physical measures including anthropometric traits (with fat-free and fat mass measures in separate sub-branches) and eye measures (keratometry),
1) a "large" branch that includes most of the traits that start to be subdivided only at $k=16$ (with asthma, lipids, and nutrient intake clusters),
2) bone-densitometry measurements,
3) hematological assays on red blood cells and platelets, and
4) a "complex" branch including assays on white blood cells, skin and hair color, autoimmune disorders, and cardiovascular diseases (hypertension, heart problems, and other cardiovascular-related traits such hand-grip strength [@pmid:25982160], and environmental/behavioral factors such as physical activity and diet).
<!--  -->
All branches show relatively highly stable clusters, where the same traits are clustered together across different resolutions even with the consensus algorithm using random seeds at each level.
<!--  -->
The arrows between clusters of different resolutions show how traits move from one group to another, and this only happens between the "complex" branch and the rest, particularly with traits expected to be linked to several others, such as white blood cells, cardiovascular and autoimmune diseases, and other related factors.
For example, the arrow from cluster 14 at $k=16$ (heart problems and related traits) to cluster 15 at $k=22$ (lipids), indicate the move of coronary artery disease, fasting glucose and blood insulin measurement to the lipids clusters, which are highly related (`CITATION`{.red}).
<!-- Possible citations above:
- https://pubmed.ncbi.nlm.nih.gov/30694691/
- IMPORTANT: https://www.ahajournals.org/doi/10.1161/CIRCULATIONAHA.118.034978
    This one has a couple of citations in the introduction
 -->
Another example is age when diabetes was first diagnosed that is moved from cluster 0 at $k=25$ to cluster 21 at $k=26$ (with autoimmune diseases such as hypo and hyperthyroidism), and intraocular pressure and eye problems from the same cluster to cluster 25 at $k=26$.
This movement of traits across highly-related clusters indicates the complexity of the relationships, where the algorithm finds meaningful but changing groups at different resolutions.


![
**Heatmap of the scores between gene modules (rows) and traits from the main clusters (columns).**
<!--  -->
`(Early draft version; we need to improve the y-axis labels on the right)`{.red}
<!--  -->
The plot shows a submatrix of $\hat{\mathbf{M}}$ for the main trait clusters shown at the bottom of the clustering tree (Figure @fig:clustering:tree), considering only gene modules that align well with at least one known pathway.
For gene modules (rows), labels on the right show the top two cell types and top two tissues where their genes are expressed in.
Values range from -5 (lighter color) to 16 (darker color).
<!--  -->
](images/clustering/global_clustermap-cell_types.svg "Heatmap with gene modules and traits"){#fig:clustering:heatmap width="100%"}


Next, we analyzed which gene modules are driving these trait clusters.
For that, we trained decision tree classifiers on the input data (@fig:clustering:design) using each cluster at $k=26$ (bottom of Figure @fig:clustering:tree) as labels.
This yielded for each cluster the top associated gene modules, where some were well-aligned to existing pathways and other modules were "novel" and expressed in relevant tissues (`REVISE`{.red}).
Results are shown in Figure @fig:clustering:heatmap, where it can be seen that some modules are highly specific to certain types of traits, and others seem to be associated with a wide range of different traits and diseases, thus potentially involved in more general biological functions.
For example, modules such as LV928 and LV30, that are known to be reused across the different stages of hematopoiesis (`CHECK AGAIN`{.red}), are strongly associated with different assays on red blood cells (erythrocytes and reticulocytes, including cell counts, mean volumes and distribution width), whereas others are highly specific, such as LV730, expressed in thrombocytes, and exclusively associated with hemathological assays on platelets.
Another such example is LV598, whose genes are expressed in corneal endothelial cells, and are almost exclusively related to keratometry measurements.
<!-- 
LV154 is also expressed in corneal endothelial cells and associated with keratometry, but not exclusively.
 -->

<!--
Autoimmune diseases are very similar, as it can be seen, but some modules show highly specific associations: for example, I THINK, thyroid-related disorders with LV155 (with genes expressed in thyroid)
-->



::: {style="color: red"}
- Maybe include Ben's question about why we expect these clustering results. My answer was more or less that far apart clusters are explained by more specific LVs to those traits, and the complex branch is more related to traits that are highly connected to all biological processes, where more subtle differences are captured only at higher resolutions.
:::
